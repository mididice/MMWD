<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI Sortable with midiDice</title>
  <!-- <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"> -->
  <!-- <link rel="stylesheet" href="/resources/demos/style.css"> -->
  <style>
  audio { width: 250px; }
  #sortable { list-style-type: none; margin: 0; padding: 0; width: 60%; }
  #sortable li { border:1px solid #000; margin: 0 3px 3px 3px; padding: 0.4em; padding-left: 1.5em; font-size: 1.4em; height: 54px; }
  #sortable li span { margin-left: 1.3em; }
  /*@keyframes animation { 0% { opacity: 0;
    transform: translate3d(0, 100px, 0) scale(0.9); } 100% { opacity: 1; transform: none; } }
  ul { padding-top: 50px; font-size: 0; }
  ul li { height: 50px; background:  #ffff80; }*/
  /*ul li:nth-child(2) { animation: animation 0.5s cubic-bezier(0.71, 0.5, 0.69, 1.4) backwards; animation-delay: 0.2s; }
  ul li:nth-child(3) { animation: animation 0.5s cubic-bezier(0.71, 0.5, 0.69, 1.4) backwards; animation-delay: 0.4s; }*/
  /*ul li:nth-child(4) { animation: animation 0.5s cubic-bezier(0.71, 0.5, 0.69, 1.4) backwards; animation-delay: 0.6s; }*/*/
  </style>
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
  $( function() {
    $( "#sortable" ).sortable({
    // items: '.ui-state-default:not(.fixed)'
      forceHelperSize: true,
      cancel: ".fixed, .cancelled",
      items: '.ui-state-default:not(.fixed)',
      change: function(event, ui){
      },
      update: function(event, ui){
        $('.ui-icon').each(function(){
          $(this).next().next().attr("disabled", false);
        });
        $('.ui-icon').filter(':last').next().next().attr("disabled", true);
      }
    });
    $( "#sortable" ).disableSelection();
  } );
    $(document).on('click', '.btn-vae', function(e) {
        // e.preventDefault();
        var premidi = $(this).parent().val();
        var nexmidi = $(this).parent().next().val();
        console.log(premidi, nexmidi)
        $(this).parent().addClass('fixed');
        $(this).parent().next().addClass('fixed');
        $(this).parent().after("<li class='ui-state-default fixed data-value="+premidi+"_"+nexmidi+"'>item"+premidi+"_"+nexmidi+"</li>").sortable();
        $(this).remove();
        // $("#sortable").sortable('refresh');
        // alert('clicked')
  });
  $(document).ready(function(){
    var lilength = $('.ui-state-default').length;
    var second = 0*1;
    var delay = (1/lilength)*1;

    $('.ui-state-default').each(function(){
      second = (delay + second).toFixed(1)*1;
      $(this).css({
        "animation": "animation 0.5s cubic-bezier(0.71, 0.5, 0.69, 1.4) backwards",
        "animation-delay": second+"s"});
    });

    $("#makeOne").click(function (e) {
        e.preventDefault();
        var result_list = [];
        console.log($(this).attr("data-value"));
        $('.midi_music').each(function(){
            result_list.push($(this).attr("data-value"));
        });
        var url = result_list.join('-');
        // $('#makeOneResult').val(result_list);
        console.log(result_list);
        //document.getElementById('makeOneForm').submit();
        location.href="music/"+url;
    });
  });
  </script>
</head>
<body>
 <button class="btn">추가하기</button>
 <ul id="sortable">
     <li class="ui-state-default cancelled" style="height:1px;"></li>
    {% for midi in json_list %}
     <li class="ui-state-default midi_music" data-value="{{ midi }}"><span class="ui-icon ">{{ midi }}</span><a id="music01"><audio controls></audio></a><button class="btn-vae">vae1</button></li>
    {% endfor %}
     <li class="ui-state-default cancelled" style="height:1px;"></li>
</ul>
 <form id="makeOneForm" action="music">
     <input type="hidden" id="makeOneResult" name="result_list">
 <button id="makeOne">음악 합치기</button>
 </form>

</body>
</html>
